<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Zumo - Sonar lib: sonar.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zumo - Sonar lib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sonar_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sonar.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="sonar_8h_source.html">sonar.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="servo_8h_source.html">servo.h</a>&quot;</code><br />
<code>#include &lt;cstdio&gt;</code><br />
<code>#include &quot;<a class="el" href="bluetooth_8h_source.html">bluetooth.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3c0fce219d1f99a3f387fa0845bee71f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a3c0fce219d1f99a3f387fa0845bee71f">SONAR_TICKS_PER_CM</a>&#160;&#160;&#160;87u</td></tr>
<tr class="memdesc:a3c0fce219d1f99a3f387fa0845bee71f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define number of TPM1 ticks per 1cm At 48MHz, 1 Tick coresponds to 2/3us. Knowing that 1cm ~ 54us we obtain 1cm = 87 ticks This value is only an aproximation as it does not take into account variance of speed of sound due to temperature and humidity.  <a href="#a3c0fce219d1f99a3f387fa0845bee71f">More...</a><br /></td></tr>
<tr class="separator:a3c0fce219d1f99a3f387fa0845bee71f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46d9d17a962653141eaacd462625e243"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a46d9d17a962653141eaacd462625e243">ECHO_MASK</a>&#160;&#160;&#160;(1 &lt;&lt; 20)</td></tr>
<tr class="memdesc:a46d9d17a962653141eaacd462625e243"><td class="mdescLeft">&#160;</td><td class="mdescRight">Echo pin mask.  <a href="#a46d9d17a962653141eaacd462625e243">More...</a><br /></td></tr>
<tr class="separator:a46d9d17a962653141eaacd462625e243"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a11b02ebbeab065aabcab82dd386024ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a11b02ebbeab065aabcab82dd386024ea">Sonar_init</a> (<a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a> InitialWorkMode)</td></tr>
<tr class="memdesc:a11b02ebbeab065aabcab82dd386024ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize Sonar and required peripherials.  <a href="#a11b02ebbeab065aabcab82dd386024ea">More...</a><br /></td></tr>
<tr class="separator:a11b02ebbeab065aabcab82dd386024ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4e65e4f3583822971be016eed5cb96e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#aa4e65e4f3583822971be016eed5cb96e">ReturnSingleMeas</a> (uint16_t result)</td></tr>
<tr class="memdesc:aa4e65e4f3583822971be016eed5cb96e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function which returns result to the user in case of single measurement.  <a href="#aa4e65e4f3583822971be016eed5cb96e">More...</a><br /></td></tr>
<tr class="separator:aa4e65e4f3583822971be016eed5cb96e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58ab62c4281bf06248f3ca5e06de6ff7"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a58ab62c4281bf06248f3ca5e06de6ff7">CalculateResult</a> ()</td></tr>
<tr class="memdesc:a58ab62c4281bf06248f3ca5e06de6ff7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function which calculates average of all samples in <a class="el" href="sonar_8c.html#a3a58739f5877fdc67409cc923fd4579d" title="Buffer containing previous measurments. Used only when averaging is enabled. ">AvgBuffer</a>.  <a href="#a58ab62c4281bf06248f3ca5e06de6ff7">More...</a><br /></td></tr>
<tr class="separator:a58ab62c4281bf06248f3ca5e06de6ff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83cdb8d63e8beb61594f296426783711"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a83cdb8d63e8beb61594f296426783711">TPM1_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a83cdb8d63e8beb61594f296426783711"><td class="mdescLeft">&#160;</td><td class="mdescRight">TPM1 interupt handler.  <a href="#a83cdb8d63e8beb61594f296426783711">More...</a><br /></td></tr>
<tr class="separator:a83cdb8d63e8beb61594f296426783711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b4e1f5dddc103f0cb52c133156c241e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a7b4e1f5dddc103f0cb52c133156c241e">SonarChangeMode</a> (<a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a> NewMode)</td></tr>
<tr class="memdesc:a7b4e1f5dddc103f0cb52c133156c241e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function allows save changing of sonar work mode.  <a href="#a7b4e1f5dddc103f0cb52c133156c241e">More...</a><br /></td></tr>
<tr class="separator:a7b4e1f5dddc103f0cb52c133156c241e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa706918bd1dfaebfc3016b456fd360b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#aa706918bd1dfaebfc3016b456fd360b0">DisableSonar</a> (void)</td></tr>
<tr class="memdesc:aa706918bd1dfaebfc3016b456fd360b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable all sonar operations and interupts.  <a href="#aa706918bd1dfaebfc3016b456fd360b0">More...</a><br /></td></tr>
<tr class="separator:aa706918bd1dfaebfc3016b456fd360b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66a59332cbb94838b8423b1437b28782"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a66a59332cbb94838b8423b1437b28782">EnableSonar</a> (void)</td></tr>
<tr class="memdesc:a66a59332cbb94838b8423b1437b28782"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable sonar operations and interupts.  <a href="#a66a59332cbb94838b8423b1437b28782">More...</a><br /></td></tr>
<tr class="separator:a66a59332cbb94838b8423b1437b28782"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0c249436f7ef0657389cc40941da5cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#af0c249436f7ef0657389cc40941da5cf">SonarStartMeas</a> (int32_t angle)</td></tr>
<tr class="memdesc:af0c249436f7ef0657389cc40941da5cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a single sonar measurment This function can be used to trigger a single measurment. Interupt will trigger <a class="el" href="sonar_8c.html#ae81e58eda1f172e0f29250cb6ac5ed7a" title="User handler for sonar measurment results This function handles results from sonar&#39;s continuous measu...">SonarDistHandler</a>.  <a href="#af0c249436f7ef0657389cc40941da5cf">More...</a><br /></td></tr>
<tr class="separator:af0c249436f7ef0657389cc40941da5cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbfc04f4efdc8692cf46217b1331bfd4"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#acbfc04f4efdc8692cf46217b1331bfd4">SonarGetDistance</a> (int32_t angle)</td></tr>
<tr class="memdesc:acbfc04f4efdc8692cf46217b1331bfd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a single sonar measurment and return distance in cm. This function can be used to trigger a single measurment.  <a href="#acbfc04f4efdc8692cf46217b1331bfd4">More...</a><br /></td></tr>
<tr class="separator:acbfc04f4efdc8692cf46217b1331bfd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae81e58eda1f172e0f29250cb6ac5ed7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#ae81e58eda1f172e0f29250cb6ac5ed7a">SonarDistHandler</a> (uint16_t distance_cm, int32_t angle)</td></tr>
<tr class="memdesc:ae81e58eda1f172e0f29250cb6ac5ed7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">User handler for sonar measurment results This function handles results from sonar's continuous measurments. It is also called when user triggered single measurment finishes. User can specify here what to do with the results. If sonar is used, user can obtain the angle at which the measurment was taken by reading global variable <a class="el" href="servo_8h.html#a6ca30760f53d2a937b251cfb0e76a6e0" title="Define Servo Position in degrees. This variable contains predicted position of a servo. ">ServoPosition</a>.  <a href="#ae81e58eda1f172e0f29250cb6ac5ed7a">More...</a><br /></td></tr>
<tr class="separator:ae81e58eda1f172e0f29250cb6ac5ed7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad2046f041ee5ecb52f1efd187ae0e9db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#ad2046f041ee5ecb52f1efd187ae0e9db">SonarMode</a> = <a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686a3388f7110f6f25a54e215eb75d5d7516">SINGLE</a></td></tr>
<tr class="memdesc:ad2046f041ee5ecb52f1efd187ae0e9db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define sonar work mode.  <a href="#ad2046f041ee5ecb52f1efd187ae0e9db">More...</a><br /></td></tr>
<tr class="separator:ad2046f041ee5ecb52f1efd187ae0e9db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af69417da33b5e397657722c33d5d00ca"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#af69417da33b5e397657722c33d5d00ca">success</a> = 0</td></tr>
<tr class="memdesc:af69417da33b5e397657722c33d5d00ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Debug variable containing total number of successful measurments.  <a href="#af69417da33b5e397657722c33d5d00ca">More...</a><br /></td></tr>
<tr class="separator:af69417da33b5e397657722c33d5d00ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75b0e501ce80a9475b3d528a69cd1d87"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a75b0e501ce80a9475b3d528a69cd1d87">fail</a> = 0</td></tr>
<tr class="memdesc:a75b0e501ce80a9475b3d528a69cd1d87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Debug variable containing total number of failed measurments.  <a href="#a75b0e501ce80a9475b3d528a69cd1d87">More...</a><br /></td></tr>
<tr class="separator:a75b0e501ce80a9475b3d528a69cd1d87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8be3272170d528da1364817561ce32e"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#ad8be3272170d528da1364817561ce32e">retry_counter</a> = 0</td></tr>
<tr class="memdesc:ad8be3272170d528da1364817561ce32e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Variable containing number of failed measurments tries; Used to timeout measurement.  <a href="#ad8be3272170d528da1364817561ce32e">More...</a><br /></td></tr>
<tr class="separator:ad8be3272170d528da1364817561ce32e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a58739f5877fdc67409cc923fd4579d"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a3a58739f5877fdc67409cc923fd4579d">AvgBuffer</a> [<a class="el" href="sonar_8h.html#a654a02dec6f794c16f31690b6ef7ec7b">SONAR_AVG_NUMBER</a>]</td></tr>
<tr class="memdesc:a3a58739f5877fdc67409cc923fd4579d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer containing previous measurments. Used only when averaging is enabled.  <a href="#a3a58739f5877fdc67409cc923fd4579d">More...</a><br /></td></tr>
<tr class="separator:a3a58739f5877fdc67409cc923fd4579d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d1c94c95701e93d300aacf96cb837a"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#aa4d1c94c95701e93d300aacf96cb837a">AvgPointer</a> = 0</td></tr>
<tr class="memdesc:aa4d1c94c95701e93d300aacf96cb837a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer indicating last measurement sample in <a class="el" href="sonar_8c.html#a3a58739f5877fdc67409cc923fd4579d" title="Buffer containing previous measurments. Used only when averaging is enabled. ">AvgBuffer</a>.  <a href="#aa4d1c94c95701e93d300aacf96cb837a">More...</a><br /></td></tr>
<tr class="separator:aa4d1c94c95701e93d300aacf96cb837a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cd4654d994cc98ddc5b4ceffa4d2c98"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar_8c.html#a2cd4654d994cc98ddc5b4ceffa4d2c98">SingleResult</a> = 0</td></tr>
<tr class="memdesc:a2cd4654d994cc98ddc5b4ceffa4d2c98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Variable containing result of single measurment done using <a class="el" href="sonar_8c.html#af0c249436f7ef0657389cc40941da5cf" title="Initialize a single sonar measurment This function can be used to trigger a single measurment...">SonarStartMeas</a> or <a class="el" href="sonar_8c.html#acbfc04f4efdc8692cf46217b1331bfd4" title="Initialize a single sonar measurment and return distance in cm. This function can be used to trigger ...">SonarGetDistance</a>. It is also used to determind how to return result to the user. If this variable is set to -1 before measurement, Sonar will set it to obtained result. If this variable is set to 0, Sonar will trigger <a class="el" href="sonar_8c.html#ae81e58eda1f172e0f29250cb6ac5ed7a" title="User handler for sonar measurment results This function handles results from sonar&#39;s continuous measu...">SonarDistHandler</a> with obtained result.  <a href="#a2cd4654d994cc98ddc5b4ceffa4d2c98">More...</a><br /></td></tr>
<tr class="separator:a2cd4654d994cc98ddc5b4ceffa4d2c98"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a46d9d17a962653141eaacd462625e243"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ECHO_MASK&#160;&#160;&#160;(1 &lt;&lt; 20)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Echo pin mask. </p>

</div>
</div>
<a class="anchor" id="a3c0fce219d1f99a3f387fa0845bee71f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_TICKS_PER_CM&#160;&#160;&#160;87u</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define number of TPM1 ticks per 1cm At 48MHz, 1 Tick coresponds to 2/3us. Knowing that 1cm ~ 54us we obtain 1cm = 87 ticks This value is only an aproximation as it does not take into account variance of speed of sound due to temperature and humidity. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Modify this parameter to include variance of speed of sound due to temperature </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a58ab62c4281bf06248f3ca5e06de6ff7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t CalculateResult </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function which calculates average of all samples in <a class="el" href="sonar_8c.html#a3a58739f5877fdc67409cc923fd4579d" title="Buffer containing previous measurments. Used only when averaging is enabled. ">AvgBuffer</a>. </p>

</div>
</div>
<a class="anchor" id="aa706918bd1dfaebfc3016b456fd360b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DisableSonar </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable all sonar operations and interupts. </p>

</div>
</div>
<a class="anchor" id="a66a59332cbb94838b8423b1437b28782"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnableSonar </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable sonar operations and interupts. </p>

</div>
</div>
<a class="anchor" id="aa4e65e4f3583822971be016eed5cb96e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReturnSingleMeas </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>result</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function which returns result to the user in case of single measurement. </p>

</div>
</div>
<a class="anchor" id="a11b02ebbeab065aabcab82dd386024ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Sonar_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a>&#160;</td>
          <td class="paramname"><em>InitialWorkMode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize Sonar and required peripherials. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">InitialWorkMode</td><td>Set initial sonar work mode </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7b4e1f5dddc103f0cb52c133156c241e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SonarChangeMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a>&#160;</td>
          <td class="paramname"><em>NewMode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function allows save changing of sonar work mode. </p>

</div>
</div>
<a class="anchor" id="ae81e58eda1f172e0f29250cb6ac5ed7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SonarDistHandler </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>distance_cm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>angle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>User handler for sonar measurment results This function handles results from sonar's continuous measurments. It is also called when user triggered single measurment finishes. User can specify here what to do with the results. If sonar is used, user can obtain the angle at which the measurment was taken by reading global variable <a class="el" href="servo_8h.html#a6ca30760f53d2a937b251cfb0e76a6e0" title="Define Servo Position in degrees. This variable contains predicted position of a servo. ">ServoPosition</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">distance_cm</td><td>Measured distance in cm. If measurment failed or was out of range function will be called with parameter 0. </td></tr>
    <tr><td class="paramname">angle</td><td>Contains the angle at which the measurement was done </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acbfc04f4efdc8692cf46217b1331bfd4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SonarGetDistance </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>angle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a single sonar measurment and return distance in cm. This function can be used to trigger a single measurment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">angle</td><td>Specify at what Servo angle measurement should be taken </td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>This function uses busy-waiting to check servo and sonar readiness </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Measured distance in cm </dd></dl>

</div>
</div>
<a class="anchor" id="af0c249436f7ef0657389cc40941da5cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SonarStartMeas </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>angle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a single sonar measurment This function can be used to trigger a single measurment. Interupt will trigger <a class="el" href="sonar_8c.html#ae81e58eda1f172e0f29250cb6ac5ed7a" title="User handler for sonar measurment results This function handles results from sonar&#39;s continuous measu...">SonarDistHandler</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">angle</td><td>Specify at what Servo angle measurement should be taken </td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>This function uses busy-waiting to check servo and sonar readiness </dd></dl>

</div>
</div>
<a class="anchor" id="a83cdb8d63e8beb61594f296426783711"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TPM1_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TPM1 interupt handler. </p>
<p>Check which channel triggered interupt:</p><ul>
<li>CH0: Detect rising/falling edge on echo pin. </li>
</ul>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a3a58739f5877fdc67409cc923fd4579d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t AvgBuffer[<a class="el" href="sonar_8h.html#a654a02dec6f794c16f31690b6ef7ec7b">SONAR_AVG_NUMBER</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Buffer containing previous measurments. Used only when averaging is enabled. </p>

</div>
</div>
<a class="anchor" id="aa4d1c94c95701e93d300aacf96cb837a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t AvgPointer = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pointer indicating last measurement sample in <a class="el" href="sonar_8c.html#a3a58739f5877fdc67409cc923fd4579d" title="Buffer containing previous measurments. Used only when averaging is enabled. ">AvgBuffer</a>. </p>

</div>
</div>
<a class="anchor" id="a75b0e501ce80a9475b3d528a69cd1d87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fail = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Debug variable containing total number of failed measurments. </p>

</div>
</div>
<a class="anchor" id="ad8be3272170d528da1364817561ce32e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t retry_counter = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Variable containing number of failed measurments tries; Used to timeout measurement. </p>

</div>
</div>
<a class="anchor" id="a2cd4654d994cc98ddc5b4ceffa4d2c98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t SingleResult = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Variable containing result of single measurment done using <a class="el" href="sonar_8c.html#af0c249436f7ef0657389cc40941da5cf" title="Initialize a single sonar measurment This function can be used to trigger a single measurment...">SonarStartMeas</a> or <a class="el" href="sonar_8c.html#acbfc04f4efdc8692cf46217b1331bfd4" title="Initialize a single sonar measurment and return distance in cm. This function can be used to trigger ...">SonarGetDistance</a>. It is also used to determind how to return result to the user. If this variable is set to -1 before measurement, Sonar will set it to obtained result. If this variable is set to 0, Sonar will trigger <a class="el" href="sonar_8c.html#ae81e58eda1f172e0f29250cb6ac5ed7a" title="User handler for sonar measurment results This function handles results from sonar&#39;s continuous measu...">SonarDistHandler</a> with obtained result. </p>
<dl class="section warning"><dt>Warning</dt><dd>Do not read or write this variable by hand! </dd></dl>

</div>
</div>
<a class="anchor" id="ad2046f041ee5ecb52f1efd187ae0e9db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686">SonarMode_t</a> SonarMode = <a class="el" href="sonar_8h.html#a14c67c304a8dae03c9577eb5e285d686a3388f7110f6f25a54e215eb75d5d7516">SINGLE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define sonar work mode. </p>
<p>This variable sets sonar work mode. You can change it using <a class="el" href="sonar_8c.html#a7b4e1f5dddc103f0cb52c133156c241e" title="This function allows save changing of sonar work mode. ">SonarChangeMode</a> </p><dl class="section warning"><dt>Warning</dt><dd>Do NOT modify this variable by hand! </dd></dl>

</div>
</div>
<a class="anchor" id="af69417da33b5e397657722c33d5d00ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t success = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Debug variable containing total number of successful measurments. </p>
<p>Default sonar work mode is SINGLE </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dfc317270c89deb8038687819d9c4f9f.html">sonar</a></li><li class="navelem"><a class="el" href="sonar_8c.html">sonar.c</a></li>
    <li class="footer">Generated on Tue Jan 27 2015 14:22:29 for Zumo - Sonar lib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
